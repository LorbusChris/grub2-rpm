From 1b6aaddc456961d87d98e0f342c70b874b2fb232 Mon Sep 17 00:00:00 2001
From: Vladimir Serbinenko <phcoder@gmail.com>
Date: Tue, 20 Jan 2015 17:55:41 +0100
Subject: [PATCH 156/506] term.h: Avoid returining 0-sized terminal as it may
 lead to division by zero.

---
 ChangeLog           | 5 +++++
 include/grub/term.h | 4 ++--
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/ChangeLog b/ChangeLog
index c60a231..141aa06 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,5 +1,10 @@
 2015-01-20  Vladimir Serbinenko  <phcoder@gmail.com>
 
+	* include/grub/term.h: Avoid returining 0-sized terminal
+	as it may lead to division by zero.
+
+2015-01-20  Vladimir Serbinenko  <phcoder@gmail.com>
+
 	* grub-core/fs/zfs.c: Avoid divisions by zero.
 
 2015-01-20  Vladimir Serbinenko  <phcoder@gmail.com>
diff --git a/include/grub/term.h b/include/grub/term.h
index 98c68a5..5ffb38f 100644
--- a/include/grub/term.h
+++ b/include/grub/term.h
@@ -334,12 +334,12 @@ void grub_term_restore_pos (struct grub_term_coordinate *pos);
 
 static inline unsigned grub_term_width (struct grub_term_output *term)
 {
-  return term->getwh(term).x;
+  return term->getwh(term).x ? : 80;
 }
 
 static inline unsigned grub_term_height (struct grub_term_output *term)
 {
-  return term->getwh(term).y;
+  return term->getwh(term).y ? : 24;
 }
 
 static inline struct grub_term_coordinate
-- 
2.4.3

